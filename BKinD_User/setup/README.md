
Welcome to BKinD!

This guide will help you set up the required environment and install all necessary software to effectively use BKinD, a tool designed for filtering and analyzing diffraction data. Follow the instructions below to ensure a smooth setup and optimal use of the BKinD application.

## Guide Overview

This guide is divided into the following sections:
1. **System Requirements**: Essential components you need to install manually beforehand.
2. **Running BKinD**: Instructions for running the application on different platforms (WSL and macOS) or via the command line.
3. **Setting Up Conda Environment**: Steps to manually configure your Conda environment.
4. **Explanation of Output**: A breakdown of the application's output.

---

## System Requirements

Before running BKinD, the following components must be installed manually. If any of these are missing, the application will terminate and display an error message:

1. **Conda**: See installation instructions below.
2. **SHELXL**: See installation instructions below.
3. **XDS**: Set up as per the instructions provided.

---

## Running the BKinD Application

Once the necessary software is installed, you can run the BKinD application in the following ways:

### 1. Running via Clickable Icons (WSL and macOS)

#### a) On WSL using `run_script_wsl.bat`:
You can run BKinD by double-clicking the pre-configured `run_script_wsl.bat`. This will automatically create and/or activate a Conda environment with the necessary dependencies and launch the BKinD application.

#### b) Creating a Desktop Shortcut for `run_script_wsl.bat`:
To make it easier to launch BKinD, you can create a desktop shortcut for `run_script_wsl.bat` and customize it with an icon from the assets folder:

- Right-click `run_script_wsl.bat` and select **Create Shortcut**.
- Right-click the newly created shortcut and select **Properties**.
- In the **Shortcut** tab, click **Change Icon...**.
- Browse to the **assets** folder and select an icon (e.g., `assets/icon.ico`).
- Click **OK** and **Apply** to set the new icon.

Now, you can double-click the shortcut on your desktop to run BKinD.

---

### 2. Running on macOS using `run_script_mac`

#### a) Running via `run_script_mac`:
Double-click the pre-configured `run_script_mac` Unix executable file. This script will create and/or activate a Conda environment with the necessary requirements and launch the BKinD application.

#### b) Creating a Desktop Shortcut for `run_script_mac`:
To simplify launching BKinD, you can create a desktop shortcut (alias) for `run_script_mac` and assign an icon from the assets folder:

- Right-click `run_script_mac` and select **Make Alias**.
- Right-click the newly created alias and select **Get Info**.
- Browse to the **assets** folder, select the icon (e.g., `assets/icon.ico`), and drag it onto the small icon in the upper-left corner of the **Get Info** window.

Now, you can double-click the alias on your desktop to run BKinD.

---

### 3. Running via Command Line

You can also run BKinD from the command line. First, navigate to the BKinD directory:

```bash
cd path/to/BKinD
```

Ensure that your Conda environment (with the requirements specified in `setup/requirements.txt`) is activated, and both SHELXL and XDS are accessible. Then run the application using:

```bash
python bkind.py
```

For systems with Python 3.x installed as `python3`:
```bash
python3 bkind.py
```

---

## Manual Setup Instructions

If you prefer to manually set up the environment, follow the detailed instructions provided further down in this document for configuring your Conda environment with all necessary dependencies.

---

## Explanation of Output

A detailed explanation of BKinDâ€™s output is provided in the **Explanation of Output** section below. This will help you understand the results generated by the application.

---

## Need Help?

If you encounter any issues during the installation or setup process, refer to the official documentation or contact the BKinD support team at [buster.blomberg@mmk.su.se](mailto:buster.blomberg@mmk.su.se).


#####################################################################
############ Instructions for Installing and Using Conda ############
#####################################################################

## Installing Conda

### 1. Download the Conda Installer

- Visit the official Conda download page: https://conda.io/projects/conda/en/latest/user-guide/install/index.html
- Choose the appropriate installer (Anaconda or Miniconda) for your operating system (Windows, macOS, Linux).

### 2. Run the Installer

- **For Windows**:
  1. Download the `.exe` installer.
  2. Double-click the installer to launch it.
  3. Follow the on-screen instructions to complete the installation.

- **For macOS**:
  1. Download the `.sh` installer.
  2. Open a terminal and execute the installer with the following command:

```bash
bash Miniconda3-latest-MacOSX-x86_64.sh
```

  3. Follow the on-screen instructions to complete the installation.

- **For Linux**:
  1. Download the `.sh` installer.
  2. Open a terminal and execute the installer with the following command:

```bash
bash Miniconda3-latest-Linux-x86_64.sh
```

  3. Follow the on-screen instructions to complete the installation.

### 3. Restart Your Terminal

Close and reopen your terminal to apply the changes.

### 4. Verify the Installation

To verify that Conda was installed correctly, run the following command:

```bash
conda --version
```

You should see the Conda version information displayed.

---

## Using Conda

### 1. Create a New Conda Environment (Recommended)

Open your terminal and create a new Conda environment named `bkind` (or choose another name) with the following command:

```bash
conda create -n bkind
```

### 2. Activate the Conda Environment

Activate your newly created environment using the command:

```bash
conda activate bkind-env
```

### 3. Install Packages

To install packages in your environment, use the following command, replacing `package_name` with the package you wish to install:

```bash
conda install package_name
```

You can also install multiple packages at once:

```bash
conda install numpy pandas
```

### 4. List Installed Packages

To view a list of all installed packages in your environment, use:

```bash
conda list
```

### 5. Update Packages

To update a specific package to the latest version, run:

```bash
conda update package_name
```

### 6. Remove Packages

To remove a package from your environment, use:

```bash
conda remove package_name
```

### 7. Deactivate the Conda Environment

To deactivate your current environment and return to the base environment, use:

```bash
conda deactivate
```

### 8. Delete a Conda Environment

To delete a Conda environment, run:

```bash
conda env remove -n environment_name
```

Replace `environment_name` with the name of the environment you wish to delete.

---

By following these instructions, you will successfully install Conda on your system and manage your Conda environments and packages efficiently.


########################################################
############ Instructions to Install SHELXL ############
########################################################

## Instructions for Installing SHELXL

### 1. Register as an Academic User

- Visit the website: http://shelx.uni-goettingen.de/register.html
- Complete the registration form. The answer to the "Xtal" question is: **P212121**.

### 2. Download the SHELXL Software

- Visit the SHELXL homepage: http://shelx.uni-goettingen.de/
- Download the appropriate version for your operating system (Windows, macOS, Linux) from: https://shelx.uni-goettingen.de/bin/

### 3. Extract the Downloaded Package

- Once downloaded, extract the contents of the package to a directory of your choice.

### 4. Move the SHELXL Executable to a Directory Included in Your System's PATH

- For **Linux and macOS**:
  
  Open a terminal and use the following command to move the `shelxl` executable to a directory in your system's PATH:

```bash
sudo mv shelxl /usr/local/bin
```

- For **Windows**:
  
Move the `shelxl.exe` file to a directory included in your PATH, such as `C:\Windows\System32`.

### 5. Verify the Installation

- To verify that SHELXL is installed correctly, open a terminal and run the following command:

```bash
shelxl
```

- If the installation is successful, the terminal should display the SHELXL version information.

By following these steps, you should be able to install SHELXL on your system and verify its successful installation.


#########################################################
############ Instructions for Setting Up XDS ############
#########################################################


## Instructions for Setting Up XDS on Linux

### 1. Become root (on Ubuntu, use `sudo -i`)

Run the following command to switch to the root user:

```bash
sudo -i
```
You will be prompted to enter your password.

### 2. Change directory to `/usr/local/bin`

Navigate to the directory where XDS will be installed:

```bash
cd /usr/local/bin
```

### 3. Download and extract the XDS software

Download the XDS software and extract it in one command:

```bash
wget -O- https://xds.mr.mpg.de/XDS-INTEL64_Linux_x86_64.tar.gz | tar xzvf -
```

### 4. Create symbolic links for the extracted files

Link the extracted XDS files to the `/usr/local/bin` directory:

```bash
ln -sf XDS-INTEL64_Linux_x86_64/* .
```

---

## Instructions for Setting Up XDS on macOS (Intel and Apple M Processors)

### 1. Obtain root privileges

Switch to the root user by running the following command:

```bash
sudo su
```
You will be prompted to enter your password.

### 2. Change directory to `/usr/local/bin`

Navigate to the directory where XDS will be installed:
```bash
cd /usr/local/bin
```

### 3. Download and extract the XDS software

Use the following command to download and extract the XDS software:

```bash
curl -L -o - https://xds.mr.mpg.de/XDS-OSX_64.tar.gz | tar xzvf -
```

### 4. Create symbolic links for the extracted files

- **For Intel processors**:

```bash
ln -sf XDS-OSX_64/* .
```

- **For Apple M processors**:

```bash
ln -sf XDS-Apple_M1/* .
```

### 5. Release root permissions

Exit the root user by running:

```bash
exit
```

---

By following these instructions, you will successfully set up XDS on your system. If you encounter any issues or need further assistance, please refer to the official XDS documentation or check https://wiki.uni-konstanz.de/xds/index.php/Installation for additional details.

#####################################################################################
############ Instructions for Setting Up Your Conda Environment MANUALLY ############
#####################################################################################

# Instructions for Manually Setting Up Your Conda Environment

To ensure BKinD runs smoothly, follow these steps to manually set up your Conda environment with all necessary dependencies.

## Step-by-Step Guide

### 1. Create a New Conda Environment (Recommended)

Open your terminal and run the following command to create a new Conda environment with the required Python version (3.12.2). You can name the environment `bkind`, or choose a different name if you prefer:

```bash
conda create -n bkind -c conda-forge cctbx-base python=3.12.2 numpy==1.26.4 pandas==2.2.1 plotly==5.19.0 tqdm==4.66.4 pillow==10.3.0 -y
```

This command will:
- Create a Conda environment named `bkind`
- Install Python 3.12.2 along with essential packages like `numpy`, `pandas`, `plotly`, `tqdm`, `pillow`, and `cctbx-base`. It will also ensure the correct version of each package.

### 2. Activate the Conda Environment

Once the environment has been created, activate it using the following command:

```bash
conda activate bkind
```

This will switch your terminal to use the newly created environment.

### 3. Install `tkinter` (For Ubuntu Users)

If you're using Ubuntu, you might need to install `tkinter` separately to enable GUI support for BKinD. Run this command to install `tkinter`:

```bash
sudo apt-get install python3-tk
```

This step is essential if you're working on an Ubuntu machine without `tkinter` pre-installed.

### 4. Run BKinD

Now that your environment is set up, you can run the BKinD application using the following command:

```bash
python bkind.py
```

### 5. Verify Package Installation (Optional)

To ensure all required packages are installed in your environment, you can list the installed packages by running:

```bash
conda list
```

This will display all installed packages along with their versions, allowing you to verify that everything is in place.

---

## Troubleshooting & Support

By following these steps, your Conda environment should be correctly set up with all the required dependencies for running BKinD. 

#######################################################################
############ Output Folder Contents and Their Descriptions ############
#######################################################################

 	filtering_stats.txt:

This text file contains statistics related to the filtering process. The file contains the following types of data:

Original and Remaining Data Counts: Details the initial number of reflections and unique ASU, as well as the remaining counts after filtering.
Filtering Parameters: Includes the target ASU percentage and the number of iterations required to reach that target.
Data Quality Metrics: Provides various metrics such as R1, FVAR, Rint, highest diffraction peak, deepest hole, and one sigma level, which assess the quality and accuracy of the filtered data.
Filtering Effectiveness: Shows the percentage of data remaining after filtering, indicating how much data was retained or removed at each filtering stage.
	
 	aggregated_filtered:

This folder contains aggregated data .csv files from the filtered datasets. It includes combined or summarized results from the individual filtered files.

	filtered_90.0 to filtered_100.0:

The files in these folders represent filtered datasets at various threshold levels (90.0, 91.0, 92.0, ..., 100.0). The numbers correspond to the percentage of data retained after filtering. These are aggregated in the folder aggregated_filtered.

	INTEGRATE.HKL:

This file contains integrated reflection intensities. It is generated during the data processing of X-ray diffraction experiments and includes information about the reflections, such as their indices, intensities, and other relevant parameters.

	XDSCONV.LP:

This log file is produced by the XDSCONV program, which is part of the XDS suite for processing X-ray diffraction data. It contains information about the conversion of data formats, such A from XDS to other formats used in crystallography.

	XDS_ASCII_NEM.HKL:

This file is another type of reflection data file, in ASCII format, which can be used for various downstream analysis steps in crystallography.

	bkind.fcf:

This file format (.fcf) contains final structure factor amplitudes and phases, which are crucial for determining the electron density map in crystallography.

	bkind.hkl:

This file contains reflection data to be refined using SHELXL.

	bkind.ins:

This file is an instruction file for the refinement program SHELXL, which is used to refine the crystal structure model. It contains initial parameters and instructions for the refinement process.

	bkind.lst:

This list file contains detailed output from the refinement process, including diagnostics, errors, and final refined parameters. It is generated by SHELXL.

	bkind.mat:

This file contain matrix data, related to the orientation or transformation matrices used in crystallography data processing.

	bkind.res:

This file is a result file from the refinement process, containing the refined atomic coordinates and other relevant structural information.

	xdsconv.inp:

This input file is used by the XDSCONV program. It contains parameters and instructions for converting XDS output files to other formats used in crystallographic analysis.

